

### 必要条件

互斥：进程对所分配到的资源进行排它性使用，在一段时间内某资源只由一个进程占用。

占有和等待：指某个进程已经持有了一个或多个资源，但是还要请求其他资源，而它请求的资源不能立即获得，需要等待。

不可抢占：即进程已经获取的资源在使用过程中不能被其他进程抢占，只能在使用完后，由该进程自己释放。

环路等待：即形成进程和请求资源之间的环路。



### 处理方法

 死锁的处理包括：不允许死锁的发生；允许死锁的发生，但是可以检测并恢复；忽略该问题（这就是当机器卡死时，重启可以解决的原理所在）。

#### 鸵鸟策略

忽略该问题

#### 死锁检测与死锁恢复

#### 死锁预防

死锁的预防即不允许死锁的发生，可以从破除死锁发生的四个必要条件入手。因为如果不具备上述四个必要条件，那么死锁就一定不会发生。

1. 互斥：不容易破除

​    2. 占有并等待：两种破除方式，不持有并等待，即如果一个进程一次请求获取不了所有资源，那么它不可占用任何资源（释放掉它已经占有的资源）。持有不等待，资源充足，只要申请求资源，就给其资源，不让它等待。

3. 不可抢占：如果一个进程所请求的资源被另一进程占有，使它可以抢占另一进程占有的资源。

4. 环路等待：对资源进行排序，即每个进程访问资源的顺序是固定的。

#### 死锁避免

 死锁的预防通过破除必要条件来使死锁一定不会发生。而死锁的预防则是允许四个必要条件的发生，但是通过一些措施使得条件不会从必要条件转为充分条件。打个比方，如果死锁是地雷并且埋在一个区域的话，死锁预防是压根就不进入雷区，而死锁避免是从雷区中找到一条安全道路。即每一步都要确保处于安全状态，安全状态是指系统能按某个顺序为每个进程分配资源（不超过其最大值）并能避免死锁，那么系统状态就是安全的。即如果存在一个安全序列，那么系统处于安全状态。如果没有这样的顺序存在，那么系统处于不安全状态。而死锁避免就是要通过一些方法找到这样一个安全序列，使系统不会发生死锁。

1. 资源请求图算法

2. 银行家算法

 当新进程进入系统时，它必须说明其可能需要的各种类型资源实例的最大数量，这一数量不能超过当前系统资源的总和。当用户申请一组资源时，系统必须确定这些资源的分配是否仍会使系统出于安全状态，如果是，就分配资源；否则，进程必须等待直到某个其他进程释放足够资源为止。

​     a). 安全性算法

定义以下几个变量Available，Max，Allocation，Need。

Available：表示当前可用的资源量

Max：表示进程所需要的最大资源

Allocation：表示进程已经占有的资源量

Need：表示进程还需要的资源量



确定计算机是否处于安全状态需要以下几步：

​     1 创建Work 和 Finish 向量，并且Work = Avallable，将Finish的每一项置为false

​     2 查找是否存在这样的i使得满足：

​       Finish[i] = false

​       Needi <= Work

如果不存在则跳到第四步。

​     3 Work = Work + Allocationi

​       Finish[i] = true

跳回第二步

​     4 如果对所有的ｉ，Finish[i] = true,那么系统处于安全状态。

通俗的讲就是先寻找没有执行完并且所需资源小于可用资源的进程，若存在这样的进程，则将可用资源分配给这个进程，使这个进程执行完毕，进程执行完毕后会释放掉它占有的资源，于是可用资源增加，然后继续循环去找满足条件的进程，直到所有进程所需资源都被满足，这样可以确保系统一直处于安全状态。

​		b). 资源请求算法

​     资源请求算法可以看做安全性算法的升级，它不在只考量进程已经拥有的和所需要的，而是又引入了每次请求所需的资源。每次请求所需的资源一定小于等于它所需的总资源，资源请求算法需要考虑的是当每次请求来时是否立即满足其要求。

设Request进程p的请求向量。即如果`Requesti[j]==k` ，那么所需要资源类型的实例数量为。



当进程做出资源申请时，采取如下动作：

- 1 如果，那么进行下一步，否则产生出错条件，因为请求已经超过了其所需的最大资源。
- 2如果Ruquest < Available**，**那么进行下一步，否则必须等待，因为没有可用的资源。
- 3 假定系统可以分配给进程所需的资源，并按如下方式修改状态：

如果所产生的资源分配状态是安全的，那么交易完成且进程Pi可分配到其所需要的资源。然而，如果新状态不安全，那么进程Pi必须等待Requesti并回复到原资源分配状态。（可以再以上面安全性算法来判断是否处于安全性状态）。



详情： https://github.com/CyC2018/CS-Notes/blob/master/notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%20-%20%E6%AD%BB%E9%94%81.md

https://blog.csdn.net/weiyongle1996/article/details/71511956

